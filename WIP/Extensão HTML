<!-- Adicionar ao index.html - Novo card no menu principal -->
<div class="menu-card" onclick="showSubmenu('gpo-tools')">
    <h3>üéØ Pol√≠ticas de Grupo (GPO)</h3>
    <p>Criar e gerenciar GPOs para mapeamento de unidades e atalhos autom√°ticos.</p>
</div>

<!-- Adicionar ap√≥s os outros submenus -->
<!-- Submenu GPO Tools -->
<div id="gpo-tools" class="submenu">
    <button class="back-btn" onclick="showMainMenu()">‚Üê Voltar</button>
    <h3>Pol√≠ticas de Grupo (GPO)</h3>
    <div class="submenu-grid">
        <div class="submenu-item" onclick="executeCommand('check-gpo-dependencies')">Verificar depend√™ncias GPO</div>
        <div class="submenu-item" onclick="showForm('create-share-with-gpo')">Criar compartilhamento com GPO</div>
        <div class="submenu-item" onclick="showForm('create-gpo-existing')">Criar GPO para compartilhamento existente</div>
        <div class="submenu-item" onclick="executeCommand('list-gpos')">Listar GPOs existentes</div>
        <div class="submenu-item" onclick="showForm('remove-gpo')">Remover GPO</div>
    </div>
</div>

<!-- Formul√°rios GPO - Adicionar na se√ß√£o de formul√°rios -->

<!-- Formul√°rio Criar Compartilhamento com GPO -->
<div id="create-share-with-gpo-form" class="form-container">
    <h3>Criar Compartilhamento com GPO Autom√°tica</h3>
    <div class="instruction-panel" style="display: block; background: #e8f4fd; border-left: 4px solid #2196F3;">
        <h4 style="color: #1976D2; margin-bottom: 10px;">üéØ O que esta fun√ß√£o faz:</h4>
        <p style="margin-bottom: 8px;">‚Ä¢ <strong>Cria o compartilhamento</strong> no Samba automaticamente</p>
        <p style="margin-bottom: 8px;">‚Ä¢ <strong>Gera uma GPO</strong> que mapeia automaticamente a unidade nos clientes</p>
        <p style="margin-bottom: 8px;">‚Ä¢ <strong>Cria atalho</strong> na √°rea de trabalho (opcional)</p>
        <p style="color: #666; font-size: 14px;">‚ö†Ô∏è Os clientes precisam executar 'gpupdate /force' para aplicar as mudan√ßas</p>
    </div>
    
    <form onsubmit="submitForm(event, 'create-share-with-gpo')">
        <div class="form-group">
            <label for="gpo-share-name">Nome do Compartilhamento:</label>
            <input type="text" id="gpo-share-name" name="share-name" placeholder="Vendas" required>
            <small style="color: #666;">Nome sem espa√ßos</small>
        </div>
        
        <div class="form-group">
            <label for="gpo-share-path">Caminho (/mnt):</label>
            <input type="text" id="gpo-share-path" name="share-path" placeholder="/vendas" required>
            <small style="color: #666;">Caminho onde os arquivos ficar√£o no servidor</small>
        </div>
        
        <div class="form-group">
            <label for="gpo-share-users">Usu√°rios/Grupos (separados por v√≠rgula):</label>
            <input type="text" id="gpo-share-users" name="share-users" placeholder="@Vendas, joao, maria" required>
            <small style="color: #666;">Ex: @Vendas, @Marketing, usuario1</small>
        </div>
        
        <div class="form-group">
            <label for="gpo-drive-letter">Letra da Unidade (A-Z):</label>
            <select id="gpo-drive-letter" name="drive-letter" required>
                <option value="">Selecione...</option>
                <option value="F">F: (Recomendado)</option>
                <option value="G">G:</option>
                <option value="H">H:</option>
                <option value="I">I:</option>
                <option value="J">J:</option>
                <option value="K">K:</option>
                <option value="L">L:</option>
                <option value="M">M:</option>
                <option value="N">N:</option>
                <option value="O">O:</option>
                <option value="P">P:</option>
                <option value="Q">Q:</option>
                <option value="R">R:</option>
                <option value="S">S:</option>
                <option value="T">T:</option>
                <option value="U">U:</option>
                <option value="V">V:</option>
                <option value="W">W:</option>
                <option value="X">X:</option>
                <option value="Y">Y:</option>
                <option value="Z">Z:</option>
            </select>
            <small style="color: #666;">Unidade que aparecer√° no Windows</small>
        </div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="gpo-create-shortcut" name="create-shortcut" value="yes">
            <label for="gpo-create-shortcut">Criar atalho na √°rea de trabalho</label>
        </div>
        
        <div class="form-group">
            <label for="gpo-writable">Grav√°vel:</label>
            <select id="gpo-writable" name="writable">
                <option value="yes">Sim</option>
                <option value="no">N√£o</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="gpo-browsable">Naveg√°vel:</label>
            <select id="gpo-browsable" name="browsable">
                <option value="yes">Sim</option>
                <option value="no">N√£o</option>
            </select>
        </div>
        
        <div style="background: #fff3cd; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #ffc107;">
            <h5 style="color: #856404; margin: 0 0 8px 0;">üí° Resultado esperado:</h5>
            <p style="color: #856404; margin: 0; font-size: 14px;">
                ‚Ä¢ Compartilhamento \\SERVIDOR\<span id="preview-share">NOME</span> criado<br>
                ‚Ä¢ Unidade <span id="preview-drive">X</span>: mapeada automaticamente<br>
                ‚Ä¢ <span id="preview-shortcut">Atalho criado na √°rea de trabalho</span><br>
                ‚Ä¢ Aplicado aos grupos: <span id="preview-users">grupos selecionados</span>
            </p>
        </div>
        
        <button type="submit" class="btn btn-success">üéØ Criar Compartilhamento + GPO</button>
        <button type="button" class="btn" onclick="hideForm()">Cancelar</button>
    </form>
</div>

<!-- Formul√°rio Criar GPO para Compartilhamento Existente -->
<div id="create-gpo-existing-form" class="form-container">
    <h3>Criar GPO para Compartilhamento Existente</h3>
    <div class="instruction-panel" style="display: block; background: #fff3cd; border-left: 4px solid #ffc107;">
        <h4 style="color: #856404; margin-bottom: 10px;">‚ö†Ô∏è Pr√©-requisito:</h4>
        <p style="margin-bottom: 8px;">‚Ä¢ O compartilhamento j√° deve existir no Samba</p>
        <p style="color: #666; font-size: 14px;">Esta fun√ß√£o apenas cria a GPO para mapear automaticamente</p>
    </div>
    
    <form onsubmit="submitForm(event, 'create-gpo-for-share')">
        <div class="form-group">
            <label for="existing-share-name">Nome do Compartilhamento Existente:</label>
            <input type="text" id="existing-share-name" name="share-name" placeholder="Marketing" required>
            <small style="color: #666;">Deve ser exatamente igual ao nome no Samba</small>
        </div>
        
        <div class="form-group">
            <label for="existing-share-path">Caminho do Compartilhamento:</label>
            <input type="text" id="existing-share-path" name="share-path" placeholder="/marketing" required>
            <small style="color: #666;">Caminho onde est√£o os arquivos (para refer√™ncia)</small>
        </div>
        
        <div class="form-group">
            <label for="existing-drive-letter">Letra da Unidade (A-Z):</label>
            <select id="existing-drive-letter" name="drive-letter" required>
                <option value="">Selecione...</option>
                <option value="F">F:</option>
                <option value="G">G:</option>
                <option value="H">H:</option>
                <option value="I">I:</option>
                <option value="J">J:</option>
                <option value="K">K:</option>
                <option value="L">L:</option>
                <option value="M">M:</option>
                <option value="N">N:</option>
                <option value="O">O:</option>
                <option value="P">P:</option>
                <option value="Q">Q:</option>
                <option value="R">R:</option>
                <option value="S">S:</option>
                <option value="T">T:</option>
                <option value="U">U:</option>
                <option value="V">V:</option>
                <option value="W">W:</option>
                <option value="X">X:</option>
                <option value="Y">Y:</option>
                <option value="Z">Z:</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="existing-share-users">Grupos/Usu√°rios Alvo:</label>
            <input type="text" id="existing-share-users" name="share-users" placeholder="@Marketing, @Diretoria" required>
            <small style="color: #666;">Quem ter√° a unidade mapeada automaticamente</small>
        </div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="existing-create-shortcut" name="create-shortcut" value="yes">
            <label for="existing-create-shortcut">Criar atalho na √°rea de trabalho</label>
        </div>
        
        <button type="submit" class="btn btn-success">üìã Criar GPO</button>
        <button type="button" class="btn" onclick="hideForm()">Cancelar</button>
    </form>
</div>

<!-- Formul√°rio Remover GPO -->
<div id="remove-gpo-form" class="form-container">
    <h3>Remover GPO</h3>
    <div class="alert alert-error active">
        <strong>Aten√ß√£o!</strong> Esta a√ß√£o remove a GPO mas n√£o afeta o compartilhamento Samba.
    </div>
    
    <form onsubmit="confirmRemoveGPO(event)">
        <div class="form-group">
            <label for="remove-gpo-uuid">UUID da GPO:</label>
            <input type="text" id="remove-gpo-uuid" name="gpo-uuid" placeholder="{12345678-1234-1234-1234-123456789ABC}" required>
            <small style="color: #666;">UUID completo com ou sem chaves { }</small>
        </div>
        
        <div style="background: #f8d7da; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #dc3545;">
            <h5 style="color: #721c24; margin: 0 0 8px 0;">üö® O que ser√° removido:</h5>
            <p style="color: #721c24; margin: 0; font-size: 14px;">
                ‚Ä¢ Arquivos da GPO no servidor<br>
                ‚Ä¢ Entrada da GPO no Active Directory<br>
                ‚Ä¢ Mapeamentos autom√°ticos de unidade param de funcionar<br>
                ‚Ä¢ Atalhos criados pela GPO param de ser aplicados
            </p>
        </div>
        
        <button type="submit" class="btn btn-danger">üóëÔ∏è Remover GPO</button>
        <button type="button" class="btn" onclick="hideForm()">Cancelar</button>
    </form>
</div>

<script>
// Adicionar ao JavaScript existente

// Preview em tempo real no formul√°rio principal
document.addEventListener('DOMContentLoaded', function() {
    // Preview do compartilhamento
    const shareNameInput = document.getElementById('gpo-share-name');
    const driveLetterSelect = document.getElementById('gpo-drive-letter');
    const shortcutCheckbox = document.getElementById('gpo-create-shortcut');
    const usersInput = document.getElementById('gpo-share-users');
    
    function updatePreview() {
        const shareName = shareNameInput?.value || 'NOME';
        const driveLetter = driveLetterSelect?.value || 'X';
        const createShortcut = shortcutCheckbox?.checked;
        const users = usersInput?.value || 'grupos selecionados';
        
        // Atualizar elementos de preview
        const previewShare = document.getElementById('preview-share');
        const previewDrive = document.getElementById('preview-drive');
        const previewShortcut = document.getElementById('preview-shortcut');
        const previewUsers = document.getElementById('preview-users');
        
        if (previewShare) previewShare.textContent = shareName;
        if (previewDrive) previewDrive.textContent = driveLetter;
        if (previewUsers) previewUsers.textContent = users;
        if (previewShortcut) {
            previewShortcut.textContent = createShortcut ? 
                'Atalho criado na √°rea de trabalho' : 
                'Sem atalho na √°rea de trabalho';
        }
    }
    
    // Adicionar listeners
    if (shareNameInput) shareNameInput.addEventListener('input', updatePreview);
    if (driveLetterSelect) driveLetterSelect.addEventListener('change', updatePreview);
    if (shortcutCheckbox) shortcutCheckbox.addEventListener('change', updatePreview);
    if (usersInput) usersInput.addEventListener('input', updatePreview);
});

// Fun√ß√£o para confirmar remo√ß√£o de GPO
function confirmRemoveGPO(event) {
    event.preventDefault();
    const uuid = document.getElementById('remove-gpo-uuid').value;

    if (!uuid) {
        showAlert('Por favor, digite o UUID da GPO', 'error');
        return;
    }

    showConfirmation(`Tem certeza que deseja remover a GPO "${uuid}"?<br><br><strong>Esta a√ß√£o √© irrevers√≠vel!</strong>`, function(confirmed) {
        if (confirmed) {
            submitForm(event, 'remove-gpo');
        }
    });
}

// Sobrescrever submitForm para GPOs (adicionar ao JavaScript existente)
const originalSubmitForm = window.submitForm;
window.submitForm = async function(event, action) {
    // Tratar checkbox create-shortcut especificamente
    if (action.includes('gpo') || action.includes('share-with-gpo')) {
        const form = event.target;
        const shortcutCheckbox = form.querySelector('input[name="create-shortcut"]');
        
        if (shortcutCheckbox) {
            // Converter checkbox para yes/no
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'create-shortcut';
            hiddenInput.value = shortcutCheckbox.checked ? 'yes' : 'no';
            form.appendChild(hiddenInput);
            
            // Remover checkbox original para evitar conflito
            shortcutCheckbox.disabled = true;
        }
    }
    
    // Chamar fun√ß√£o original
    return originalSubmitForm.call(this, event, action);
};

// Fun√ß√£o para validar letra da unidade
function validateDriveLetter(letter) {
    return /^[A-Z]$/.test(letter);
}

// Valida√ß√£o em tempo real
document.addEventListener('DOMContentLoaded', function() {
    const driveSelects = document.querySelectorAll('select[name="drive-letter"]');
    
    driveSelects.forEach(select => {
        select.addEventListener('change', function() {
            if (this.value && !validateDriveLetter(this.value)) {
                this.style.borderColor = '#e74c3c';
                showAlert('Letra da unidade deve ser de A-Z', 'warning');
            } else {
                this.style.borderColor = '#ddd';
            }
        });
    });
});

// Fun√ß√£o auxiliar para mostrar instru√ß√µes GPO
function showGPOInstructions() {
    const instructions = `
    <div style="background: #e8f4fd; padding: 20px; border-radius: 8px; margin: 20px 0;">
        <h4 style="color: #1976D2; margin-bottom: 15px;">üìã Como usar as GPOs criadas:</h4>
        
        <h5 style="color: #333; margin: 15px 0 8px 0;">1Ô∏è‚É£ Vincular GPO √† OU (via RSAT):</h5>
        <p style="margin: 0 0 8px 20px; font-family: monospace; background: #f5f5f5; padding: 5px; border-radius: 3px;">
        Group Policy Management ‚Üí Sua OU ‚Üí Link an Existing GPO ‚Üí Selecionar GPO
        </p>
        
        <h5 style="color: #333; margin: 15px 0 8px 0;">2Ô∏è‚É£ Ou vincular via comando:</h5>
        <p style="margin: 0 0 8px 20px; font-family: monospace; background: #f5f5f5; padding: 5px; border-radius: 3px;">
        samba-tool gpo setlink "OU=MinhaOU,DC=dominio,DC=local" {UUID-DA-GPO}
        </p>
        
        <h5 style="color: #333; margin: 15px 0 8px 0;">3Ô∏è‚É£ Aplicar nos clientes:</h5>
        <p style="margin: 0 0 8px 20px; font-family: monospace; background: #f5f5f5; padding: 5px; border-radius: 3px;">
        gpupdate /force
        </p>
        
        <h5 style="color: #333; margin: 15px 0 8px 0;">4Ô∏è‚É£ Verificar aplica√ß√£o:</h5>
        <p style="margin: 0 0 0 20px; font-family: monospace; background: #f5f5f5; padding: 5px; border-radius: 3px;">
        gpresult /r
        </p>
    </div>`;
    
    showResult(instructions);
}

</script>
